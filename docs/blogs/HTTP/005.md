---
title: UDP、TCP
date: 2025-07-02
categories:
  - 网络协议
tags:
  - HTTP
---

## TCP 和 UDP 的区别
+ 先是名称上的区别，tcp 叫做传输控制协议，udp 叫做用户数据包协议
+ tcp 是面向连接的，udp 是无连接的，简单来说就是发送数据前不需要建立连接
+ tcp 是可靠传输的，也就是在传输数据时 tcp 会保证数据无差错、不丢失、不重复、按需到达；udp 是尽最大努力交付
+ tcp 面向字节流，udp 面向报文

## TCP/IP 五层模型的协议

1. 物理层：负责光电信号传递方式。集线器工作在物理层。以太网协议。
2. 数据链路层：负责设备之间的数据帧的传输和识别。交换机工作在数据链路层。例如网卡设备的驱动，帧同步，冲突检测，数据差错校验等工作。
3. 网络层：负责地址管理和路由选择。路由器工作在网络层。
4. 传输层：负责两台主机之间的数据传输。
5. 应用层：负责应用程序之间的沟通。网络编程主要针对的就是应用层。

## OSI七层模型

![image](https://i-blog.csdnimg.cn/direct/582f0ccc7b1243a295007531e4586e99.png)

## TCP 的三次握手
1. 客户端：发送连接请求（喂，听得到吗？）
    1. 发送包 序号SYN J
2. 服务端：我收到了请求，确认可以连接（听得到，你听得到我吗）
    1. 发送包 序号SYN K 和 确认包 序号ACK J + 1
3. 客户端：收到服务端确认信息，确认连接建立（听到了，我们可以说话了）
    1. 确认包 序号ACK K + 1

- 发送序号是上一次的确认序号+1
- 确认序号是上一次发送信号+1
![image](https://i-blog.csdnimg.cn/direct/081e417d6ac94d56a025d3e1abc3077c.png)

### 总结
1. 第一次握手

客户端向服务器发送 `SYN` 标志位（序号是 `J` ），并进入` SYN_SEND` 状态（等待服务器确认状态）。

2. 第二次握手
    
服务器收到来自客户端的 `SYN` `J`，服务端会确认该数据包已收到并发送 `ACK` 标志位（序号是 `J + 1`） 和 `SYN` 标志位（序号是 `K` ），服务器进入 `SYN_RECV`（请求接收并等待客户端确认状态）

3. 第三次握手

客户端进入连接建立状态后，向服务器发送 `ACK` 标志位（序号是` K + 1`）确认客户端已收到建立连接确认，服务器收到 `ACK` 标志位后，服务端进入连接已建立状态


## 四次挥手

1. 第一次挥手

客户端认为没有数据要再发送给服务器端，它就向服务器发送一个 FIN 报文段，申请断开客户端到服务器端的连接。发送后客户端进入 FIN_WAIT_1 状态。

2. 第二次挥手

服务器端接收到客户端释放连接的请求后，向客户端发送一个确认报文段，表示已经接收到了客户端释放连接的 请求，以后不再接收客户端发送过来的数据。但是因为连接是全双工的，所以此时，服务器端还可以向客户端发送数据。服务器端进入 CLOSE_WAIT 状态。客户端收到确认后，进入 FIN_WAIT_2 状态。

3. 第三次挥手

服务器端发送完所有数据后，向客户端发送 FIN 报文段，申请断开服务器端到客户端的连接。发送后进入 LAS T_ACK 状态。

4. 第四次挥手

客户端接收到 FIN 请求后，向服务器端发送一个确认应答，并进入 TIME_WAIT 阶段。该阶段会持续一段时间， 这个时间为报文段在网络中的最大生存时间，如果该时间内服务端没有重发请求的话，客户端进入 CLOSED 的状态。如果收到 服务器的重发请求就重新发送确认报文段。服务器端收到客户端的确认报文段后就进入 CLOSED 状态，这样全双工的连接就被释放了。

